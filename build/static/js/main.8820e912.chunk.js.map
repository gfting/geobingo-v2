{"version":3,"sources":["utils.js","components/Link.js","constants.js","components/LinkList.js","components/CreateLink.js","components/Header.js","components/Login.js","components/Search.js","components/App.js","serviceWorker.js","index.js"],"names":["timeDifferenceForDate","date","current","previous","elapsed","milliSecondsPerMinute","Math","round","milliSecondsPerHour","milliSecondsPerDay","timeDifference","Date","getTime","VOTE_MUTATION","gql","Link","authToken","localStorage","getItem","className","this","props","index","mutation","variables","linkId","link","id","update","store","vote","data","updateStoreAfterVote","voteMutation","onClick","description","url","votes","length","postedBy","name","createdAt","Component","FEED_QUERY","NEW_LINKS_SUBSCRIPTION","NEW_VOTES_SUBSCRIPTION","LinkList","_updateCacheAfterVote","createVote","isNewPage","location","pathname","includes","page","parseInt","match","params","skip","first","orderBy","readQuery","query","feed","links","find","writeQuery","_subscribeToNewLinks","subscribeToMore","document","updateQuery","prev","subscriptionData","newLink","Object","assign","count","__typename","_subscribeToNewVotes","_getQueryVariables","_getLinksToRender","rankedLinks","slice","sort","l1","l2","_nextPage","nextPage","history","push","_previousPage","previousPage","loading","error","linksToRender","pageIndex","map","key","POST_MUTATION","CreateLink","state","value","onChange","e","setState","target","type","placeholder","onCompleted","post","unshift","postMutation","Header","to","removeItem","withRouter","SIGNUP_MUTATION","LOGIN_MUTATION","Login","login","email","password","_confirm","a","signup","token","_saveUserData","setItem","FEED_SEARCH_QUERY","Search","filter","_executeSearch","client","result","withApollo","App","exact","path","render","component","Boolean","window","hostname","httpLink","createHttpLink","uri","authLink","setContext","_","headers","authorization","wsLink","WebSocketLink","options","reconnect","connectionParams","split","getMainDefinition","kind","operation","concat","ApolloClient","cache","InMemoryCache","ReactDOM","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.8820e912.chunk.js","sourcesContent":["function timeDifference(current, previous) {\r\n  const milliSecondsPerMinute = 60 * 1000\r\n  const milliSecondsPerHour = milliSecondsPerMinute * 60\r\n  const milliSecondsPerDay = milliSecondsPerHour * 24\r\n  const milliSecondsPerMonth = milliSecondsPerDay * 30\r\n  const milliSecondsPerYear = milliSecondsPerDay * 365\r\n\r\n  const elapsed = current - previous\r\n\r\n  if (elapsed < milliSecondsPerMinute / 3) {\r\n    return 'just now'\r\n  }\r\n\r\n  if (elapsed < milliSecondsPerMinute) {\r\n    return 'less than 1 min ago'\r\n  } else if (elapsed < milliSecondsPerHour) {\r\n    return Math.round(elapsed / milliSecondsPerMinute) + ' min ago'\r\n  } else if (elapsed < milliSecondsPerDay) {\r\n    return Math.round(elapsed / milliSecondsPerHour) + ' h ago'\r\n  } else if (elapsed < milliSecondsPerMonth) {\r\n    return Math.round(elapsed / milliSecondsPerDay) + ' days ago'\r\n  } else if (elapsed < milliSecondsPerYear) {\r\n    return Math.round(elapsed / milliSecondsPerMonth) + ' mo ago'\r\n  } else {\r\n    return Math.round(elapsed / milliSecondsPerYear) + ' years ago'\r\n  }\r\n}\r\n\r\nexport function timeDifferenceForDate(date) {\r\n  const now = new Date().getTime()\r\n  const updated = new Date(date).getTime()\r\n  return timeDifference(now, updated)\r\n}\r\n","import React, { Component } from 'react'\r\nimport { AUTH_TOKEN } from '../constants'\r\nimport { timeDifferenceForDate } from '../utils'\r\nimport { Mutation } from 'react-apollo'\r\nimport gql from 'graphql-tag'\r\n\r\n/* eslint-disable */\r\n\r\nconst VOTE_MUTATION = gql`\r\n  mutation VoteMutation($linkId: ID!) {\r\n    vote(linkId: $linkId) {\r\n      id\r\n      link {\r\n        votes {\r\n          id\r\n          user {\r\n            id\r\n          }\r\n        }\r\n      }\r\n      user {\r\n        id\r\n      }\r\n    }\r\n  }\r\n`\r\n\r\nclass Link extends Component {\r\n  render() {\r\n    const authToken = localStorage.getItem(AUTH_TOKEN)\r\n\r\n    return (\r\n      <div className=\"flex mt2 items-start\">\r\n        <div className=\"flex items-center\">\r\n          <span className=\"gray\">{this.props.index + 1}.</span>\r\n          {authToken && (\r\n            <Mutation\r\n              mutation={VOTE_MUTATION}\r\n              variables={{ linkId: this.props.link.id }}\r\n              update={(store, { data: { vote } }) =>\r\n                this.props.updateStoreAfterVote(store, vote, this.props.link.id)\r\n              }\r\n            >\r\n              {voteMutation => (\r\n                <div className=\"ml1 gray f11\" onClick={voteMutation}>\r\n                  ▲\r\n                </div>\r\n              )}\r\n            </Mutation>\r\n          )}\r\n        </div>\r\n        <div className=\"ml1\">\r\n          <div>\r\n            {this.props.link.description} ({this.props.link.url})\r\n          </div>\r\n          <div className=\"f6 lh-copy gray\">\r\n            {this.props.link.votes.length} votes | by{' '}\r\n            {this.props.link.postedBy\r\n              ? this.props.link.postedBy.name\r\n              : 'Unknown'}{' '}\r\n            {timeDifferenceForDate(this.props.link.createdAt)}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Link","export const AUTH_TOKEN = 'auth-token'\r\nexport const LINKS_PER_PAGE = 5\r\n","import React, { Component, Fragment } from 'react'\r\nimport Link from './Link'\r\nimport { Query } from 'react-apollo'\r\nimport gql from 'graphql-tag'\r\nimport { LINKS_PER_PAGE } from '../constants'\r\n\r\n/* eslint-disable */\r\n\r\nexport const FEED_QUERY = gql`\r\n  query FeedQuery($first: Int, $skip: Int, $orderBy: LinkOrderByInput) {\r\n    feed(first: $first, skip: $skip, orderBy: $orderBy) {\r\n      links {\r\n        id\r\n        createdAt\r\n        url\r\n        description\r\n        postedBy {\r\n          id\r\n          name\r\n        }\r\n        votes {\r\n          id\r\n          user {\r\n            id\r\n          }\r\n        }\r\n      }\r\n      count\r\n    }\r\n  }\r\n`\r\n\r\nconst NEW_LINKS_SUBSCRIPTION = gql`\r\n  subscription {\r\n    newLink {\r\n      id\r\n      url\r\n      description\r\n      createdAt\r\n      postedBy {\r\n        id\r\n        name\r\n      }\r\n      votes {\r\n        id\r\n        user {\r\n          id\r\n        }\r\n      }\r\n    }\r\n  }\r\n`\r\n\r\nconst NEW_VOTES_SUBSCRIPTION = gql`\r\n  subscription {\r\n    newVote {\r\n      id\r\n      link {\r\n        id\r\n        url\r\n        description\r\n        createdAt\r\n        postedBy {\r\n          id\r\n          name\r\n        }\r\n        votes {\r\n          id\r\n          user {\r\n            id\r\n          }\r\n        }\r\n      }\r\n      user {\r\n        id\r\n      }\r\n    }\r\n  }\r\n`\r\n\r\nclass LinkList extends Component {\r\n  _updateCacheAfterVote = (store, createVote, linkId) => {\r\n    const isNewPage = this.props.location.pathname.includes('new')\r\n    const page = parseInt(this.props.match.params.page, 10)\r\n\r\n    const skip = isNewPage ? (page - 1) * LINKS_PER_PAGE : 0\r\n    const first = isNewPage ? LINKS_PER_PAGE : 100\r\n    const orderBy = isNewPage ? 'createdAt_DESC' : null\r\n    const data = store.readQuery({\r\n      query: FEED_QUERY,\r\n      variables: { first, skip, orderBy },\r\n    })\r\n\r\n    const votedLink = data.feed.links.find(link => link.id === linkId)\r\n    votedLink.votes = createVote.link.votes\r\n    store.writeQuery({ query: FEED_QUERY, data })\r\n  }\r\n\r\n  _subscribeToNewLinks = subscribeToMore => {\r\n    subscribeToMore({\r\n      document: NEW_LINKS_SUBSCRIPTION,\r\n      updateQuery: (prev, { subscriptionData }) => {\r\n        if (!subscriptionData.data) return prev\r\n        const newLink = subscriptionData.data.newLink\r\n        const exists = prev.feed.links.find(({ id }) => id === newLink.id)\r\n        if (exists) return prev\r\n\r\n        return Object.assign({}, prev, {\r\n          feed: {\r\n            links: [newLink, ...prev.feed.links],\r\n            count: prev.feed.links.length + 1,\r\n            __typename: prev.feed.__typename,\r\n          },\r\n        })\r\n      },\r\n    })\r\n  }\r\n\r\n  _subscribeToNewVotes = subscribeToMore => {\r\n    subscribeToMore({\r\n      document: NEW_VOTES_SUBSCRIPTION,\r\n    })\r\n  }\r\n  _getQueryVariables = () => {\r\n    const isNewPage = this.props.location.pathname.includes('new')\r\n    const page = parseInt(this.props.match.params.page, 10)\r\n\r\n    const skip = isNewPage ? (page - 1) * LINKS_PER_PAGE : 0\r\n    const first = isNewPage ? LINKS_PER_PAGE : 100\r\n    const orderBy = isNewPage ? 'createdAt_DESC' : null\r\n    return { first, skip, orderBy }\r\n  }\r\n\r\n  _getLinksToRender = data => {\r\n    const isNewPage = this.props.location.pathname.includes('new')\r\n    if (isNewPage) {\r\n      return data.feed.links\r\n    }\r\n    const rankedLinks = data.feed.links.slice()\r\n    rankedLinks.sort((l1, l2) => l2.votes.length - l1.votes.length)\r\n    return rankedLinks\r\n  }\r\n  _nextPage = data => {\r\n    const page = parseInt(this.props.match.params.page, 10)\r\n    if (page <= data.feed.count / LINKS_PER_PAGE) {\r\n      const nextPage = page + 1\r\n      this.props.history.push(`/new/${nextPage}`)\r\n    }\r\n  }\r\n\r\n  _previousPage = () => {\r\n    const page = parseInt(this.props.match.params.page, 10)\r\n    if (page > 1) {\r\n      const previousPage = page - 1\r\n      this.props.history.push(`/new/${previousPage}`)\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Query query={FEED_QUERY} variables={this._getQueryVariables()}>\r\n        {({ loading, error, data, subscribeToMore }) => {\r\n          if (loading) return <div>Fetching</div>\r\n          if (error) return <div>Error</div>\r\n\r\n          this._subscribeToNewLinks(subscribeToMore)\r\n          this._subscribeToNewVotes(subscribeToMore)\r\n\r\n          const linksToRender = this._getLinksToRender(data)\r\n          const isNewPage = this.props.location.pathname.includes('new')\r\n          const pageIndex = this.props.match.params.page\r\n            ? (this.props.match.params.page - 1) * LINKS_PER_PAGE\r\n            : 0\r\n\r\n          return (\r\n            <Fragment>\r\n              {linksToRender.map((link, index) => (\r\n                <Link\r\n                  key={link.id}\r\n                  link={link}\r\n                  index={index + pageIndex}\r\n                  updateStoreAfterVote={this._updateCacheAfterVote}\r\n                />\r\n              ))}\r\n              {isNewPage && (\r\n                <div className=\"flex ml4 mv3 gray\">\r\n                  <div className=\"pointer mr2\" onClick={this._previousPage}>\r\n                    Previous\r\n                  </div>\r\n                  <div className=\"pointer\" onClick={() => this._nextPage(data)}>\r\n                    Next\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </Fragment>\r\n          )\r\n        }}\r\n      </Query>\r\n    )\r\n  }\r\n}\r\n\r\nexport default LinkList\r\n","import React, { Component } from 'react'\r\nimport { Mutation } from 'react-apollo'\r\nimport gql from 'graphql-tag'\r\nimport { FEED_QUERY } from './LinkList'\r\nimport { LINKS_PER_PAGE } from '../constants'\r\n\r\n/* eslint-disable */\r\n\r\nconst POST_MUTATION = gql`\r\n  mutation PostMutation($description: String!, $url: String!) {\r\n    post(description: $description, url: $url) {\r\n      id\r\n      createdAt\r\n      url\r\n      description\r\n    }\r\n  }\r\n`\r\n\r\nclass CreateLink extends Component {\r\n  state = {\r\n    description: '',\r\n    url: '',\r\n  }\r\n\r\n  render() {\r\n    const { description, url } = this.state\r\n    return (\r\n      <div>\r\n        <div className=\"flex flex-column mt3\">\r\n          <input\r\n            className=\"mb2\"\r\n            value={description}\r\n            onChange={e => this.setState({ description: e.target.value })}\r\n            type=\"text\"\r\n            placeholder=\"A description for the link\"\r\n          />\r\n          <input\r\n            className=\"mb2\"\r\n            value={url}\r\n            onChange={e => this.setState({ url: e.target.value })}\r\n            type=\"text\"\r\n            placeholder=\"The URL for the link\"\r\n          />\r\n        </div>\r\n        <Mutation\r\n          mutation={POST_MUTATION}\r\n          variables={{ description, url }}\r\n          onCompleted={() => this.props.history.push('/new/1')}\r\n          update={(store, { data: { post } }) => {\r\n            const first = LINKS_PER_PAGE\r\n            const skip = 0\r\n            const orderBy = 'createdAt_DESC'\r\n            const data = store.readQuery({\r\n              query: FEED_QUERY,\r\n              variables: { first, skip, orderBy },\r\n            })\r\n            data.feed.links.unshift(post)\r\n            store.writeQuery({\r\n              query: FEED_QUERY,\r\n              data,\r\n              variables: { first, skip, orderBy },\r\n            })\r\n          }}\r\n        >\r\n          {postMutation => <button onClick={postMutation}>Submit</button>}\r\n        </Mutation>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default CreateLink\r\n","import React, { Component } from 'react'\r\nimport { Link } from 'react-router-dom'\r\nimport { withRouter } from 'react-router'\r\nimport { AUTH_TOKEN } from '../constants'\r\n\r\n/* eslint-disable */\r\n\r\nclass Header extends Component {\r\n  render() {\r\n    const authToken = localStorage.getItem(AUTH_TOKEN)\r\n    return (\r\n      <div className=\"flex pa1 justify-between nowrap orange\">\r\n        <div className=\"flex flex-fixed black\">\r\n          <div className=\"fw7 mr1\">Hacker News</div>\r\n          <Link to=\"/\" className=\"ml1 no-underline black\">\r\n            new\r\n          </Link>\r\n          <div className=\"ml1\">|</div>\r\n          <Link to=\"/top\" className=\"ml1 no-underline black\">\r\n            top\r\n          </Link>\r\n          <div className=\"ml1\">|</div>\r\n          <Link to=\"/search\" className=\"ml1 no-underline black\">\r\n            search\r\n          </Link>\r\n          {authToken && (\r\n            <div className=\"flex\">\r\n              <div className=\"ml1\">|</div>\r\n              <Link to=\"/create\" className=\"ml1 no-underline black\">\r\n                submit\r\n              </Link>\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div className=\"flex flex-fixed\">\r\n          {authToken ? (\r\n            <div\r\n              className=\"ml1 pointer black\"\r\n              onClick={() => {\r\n                localStorage.removeItem(AUTH_TOKEN)\r\n                this.props.history.push(`/`)\r\n              }}\r\n            >\r\n              logout\r\n            </div>\r\n          ) : (\r\n              <Link to=\"/login\" className=\"ml1 no-underline black\">\r\n                login\r\n            </Link>\r\n            )}\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default withRouter(Header)","import React, { Component } from 'react'\r\nimport { AUTH_TOKEN } from '../constants'\r\nimport { Mutation } from 'react-apollo'\r\nimport gql from 'graphql-tag'\r\n\r\n/* eslint-disable */\r\n\r\nconst SIGNUP_MUTATION = gql`\r\n  mutation SignupMutation($email: String!, $password: String!, $name: String!) {\r\n    signup(email: $email, password: $password, name: $name) {\r\n      token\r\n    }\r\n  }\r\n`\r\n\r\nconst LOGIN_MUTATION = gql`\r\n  mutation LoginMutation($email: String!, $password: String!) {\r\n    login(email: $email, password: $password) {\r\n      token\r\n    }\r\n  }\r\n`\r\n\r\nclass Login extends Component {\r\n  state = {\r\n    login: true, // switch between Login and SignUp\r\n    email: '',\r\n    password: '',\r\n    name: '',\r\n  }\r\n\r\n  render() {\r\n    const { login, email, password, name } = this.state\r\n    return (\r\n      <div>\r\n        <h4 className=\"mv3\">{login ? 'Login' : 'Sign Up'}</h4>\r\n        <div className=\"flex flex-column\">\r\n          {!login && (\r\n            <input\r\n              value={name}\r\n              onChange={e => this.setState({ name: e.target.value })}\r\n              type=\"text\"\r\n              placeholder=\"Your name\"\r\n            />\r\n          )}\r\n          <input\r\n            value={email}\r\n            onChange={e => this.setState({ email: e.target.value })}\r\n            type=\"text\"\r\n            placeholder=\"Your email address\"\r\n          />\r\n          <input\r\n            value={password}\r\n            onChange={e => this.setState({ password: e.target.value })}\r\n            type=\"password\"\r\n            placeholder=\"Choose a safe password\"\r\n          />\r\n        </div>\r\n        <div className=\"flex mt3\">\r\n          <Mutation\r\n            mutation={login ? LOGIN_MUTATION : SIGNUP_MUTATION}\r\n            variables={{ email, password, name }}\r\n            onCompleted={data => this._confirm(data)}\r\n          >\r\n            {mutation => (\r\n              <div className=\"pointer mr2 button\" onClick={mutation}>\r\n                {login ? 'login' : 'create account'}\r\n              </div>\r\n            )}\r\n          </Mutation>\r\n          <div\r\n            className=\"pointer button\"\r\n            onClick={() => this.setState({ login: !login })}\r\n          >\r\n            {login ? 'need to create an account?' : 'already have an account?'}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  _confirm = async data => {\r\n    const { token } = this.state.login ? data.login : data.signup\r\n    this._saveUserData(token)\r\n    this.props.history.push(`/`)\r\n  }\r\n\r\n  _saveUserData = token => {\r\n    localStorage.setItem(AUTH_TOKEN, token)\r\n  }\r\n}\r\n\r\nexport default Login\r\n","import React, { Component } from 'react'\r\nimport { withApollo } from 'react-apollo'\r\nimport gql from 'graphql-tag'\r\nimport Link from './Link'\r\n\r\n/* eslint-disable */\r\n\r\nconst FEED_SEARCH_QUERY = gql`\r\n  query FeedSearchQuery($filter: String!) {\r\n    feed(filter: $filter) {\r\n      links {\r\n        id\r\n        url\r\n        description\r\n        createdAt\r\n        postedBy {\r\n          id\r\n          name\r\n        }\r\n        votes {\r\n          id\r\n          user {\r\n            id\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n`\r\n\r\nclass Search extends Component {\r\n  state = {\r\n    links: [],\r\n    filter: '',\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div>\r\n        <div>\r\n          Search\r\n          <input\r\n            type=\"text\"\r\n            onChange={e => this.setState({ filter: e.target.value })}\r\n          />\r\n          <button onClick={() => this._executeSearch()}>OK</button>\r\n        </div>\r\n        {this.state.links.map((link, index) => (\r\n          <Link key={link.id} link={link} index={index} />\r\n        ))}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  _executeSearch = async () => {\r\n    const { filter } = this.state\r\n    const result = await this.props.client.query({\r\n      query: FEED_SEARCH_QUERY,\r\n      variables: { filter },\r\n    })\r\n    const links = result.data.feed.links\r\n    this.setState({ links })\r\n  }\r\n}\r\n\r\nexport default withApollo(Search)\r\n","import React, { Component } from 'react';\r\nimport LinkList from './LinkList';\r\nimport CreateLink from './CreateLink';\r\nimport Header from './Header';\r\nimport { Switch, Route, Redirect } from 'react-router-dom';\r\nimport Login from './Login';\r\nimport Search from './Search';\r\n\r\nclass App extends Component {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div className=\"center w85\">\r\n\t\t\t\t<Header />\r\n\t\t\t\t<div className=\"ph3 pv1 background-gray\">\r\n\t\t\t\t\t<Switch>\r\n\t\t\t\t\t\t<Route exact path=\"/\" render={() => <Redirect to=\"/new/1\" />} />\r\n\t\t\t\t\t\t<Route exact path=\"/create\" component={CreateLink} />\r\n\t\t\t\t\t\t<Route exact path=\"/login\" component={Login} />\r\n\t\t\t\t\t\t<Route exact path=\"/search\" component={Search} />\r\n\t\t\t\t\t\t<Route exact path=\"/top\" component={LinkList} />\r\n\t\t\t\t\t\t<Route exact path=\"/new/:page\" component={LinkList} />\r\n\t\t\t\t\t</Switch>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read http://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\r\n    ),\r\n)\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href)\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config)\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit http://bit.ly/CRA-PWA',\r\n          )\r\n        })\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config)\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing\r\n        if (installingWorker == null) {\r\n          return\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.',\r\n              )\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration)\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.')\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration)\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error)\r\n    })\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type')\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload()\r\n          })\r\n        })\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config)\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.',\r\n      )\r\n    })\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister()\r\n    })\r\n  }\r\n}\r\n","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport './styles/index.css'\r\nimport App from './components/App'\r\nimport * as serviceWorker from './serviceWorker'\r\nimport { ApolloProvider } from 'react-apollo'\r\nimport { ApolloClient } from 'apollo-client'\r\nimport { createHttpLink } from 'apollo-link-http'\r\nimport { InMemoryCache } from 'apollo-cache-inmemory'\r\nimport { BrowserRouter } from 'react-router-dom'\r\nimport { setContext } from 'apollo-link-context'\r\nimport { AUTH_TOKEN } from './constants'\r\nimport { split } from 'apollo-link'\r\nimport { WebSocketLink } from 'apollo-link-ws'\r\nimport { getMainDefinition } from 'apollo-utilities'\r\n\r\nconst httpLink = createHttpLink({\r\n  uri: 'http://localhost:4000',\r\n})\r\n\r\nconst authLink = setContext((_, { headers }) => {\r\n  const token = localStorage.getItem(AUTH_TOKEN)\r\n  return {\r\n    headers: {\r\n      ...headers,\r\n      authorization: token ? `Bearer ${token}` : '',\r\n    },\r\n  }\r\n})\r\n\r\nconst wsLink = new WebSocketLink({\r\n  uri: `ws://localhost:4000`,\r\n  options: {\r\n    reconnect: true,\r\n    connectionParams: {\r\n      authToken: localStorage.getItem(AUTH_TOKEN),\r\n    },\r\n  },\r\n})\r\n\r\nconst link = split(\r\n  ({ query }) => {\r\n    const { kind, operation } = getMainDefinition(query)\r\n    return kind === 'OperationDefinition' && operation === 'subscription'\r\n  },\r\n  wsLink,\r\n  authLink.concat(httpLink),\r\n)\r\n\r\nconst client = new ApolloClient({\r\n  link,\r\n  cache: new InMemoryCache(),\r\n})\r\n\r\nReactDOM.render(\r\n  <BrowserRouter>\r\n    <ApolloProvider client={client}>\r\n      <App />\r\n    </ApolloProvider>\r\n  </BrowserRouter>,\r\n  document.getElementById('root'),\r\n)\r\nserviceWorker.unregister()\r\n"],"sourceRoot":""}